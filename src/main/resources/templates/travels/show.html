<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta th:field="*{viewport}" content="width=device-width, initial-scale=1.0" />
    <title>Show Travel</title>

    <!-- FAVICON -->
    <link rel="icon" th:href="@{/img/favicon.ico}" type="image/x-icon" />

    <!-- IMPORT CSS -->
    <th:block th:replace="~{fragments :: import-css}"></th:block>

    <!-- IMPORT MAPS -->
    <th:block th:replace="~{fragments :: import-maps}"></th:block>
    
    <!-- Show Maps in Page JS -->
    <script th:src="@{/js/maps-with-marker.js}" defer></script>
  </head>
  <body>
    <!-- Header -->
    <header class="mb-5">
      <th:block th:replace="~{fragments :: navbar('none')}"></th:block>
    </header>

    <!-- Main -->
    <main class="container my-5" th:object="${travel}">
      <div class="d-flex flex-column flex-lg-row mt-3">
        <!-- Images and Videos Carousel -->
        <div id="carousel" class="carousel slide">
          <!-- Images and Videos -->
          <div class="carousel-inner ratio ratio-4x3 object-fit-contain">
            <!-- If there are NOT Images or Videos -->
            <th:block th:if="${travel.photos.size() == 0 and travel.videos.size() == 0}">
              <!-- Fallback -->
              <div class="carousel-item d-flex align-items-center justify-content-center active">
                <h2><i>No images available</i></h2>
              </div>
            </th:block>

            <!-- Show all Images -->
            <th:block th:each="photo, iterStat : ${travel.photos}" th:if="${travel.photos.size() != 0}">
              <div th:class="carousel-item" th:classappend="${iterStat.index == 0} ? ' active'">
                <img th:src="${photo}" class="d-block w-100 h-100 object-fit-contain" alt="Photo" />
              </div>
            </th:block>

            <!-- Show all Videos -->
            <th:block th:each="video, iterStat : ${travel.videos}" th:if="${travel.videos.size() != 0}">
              <div th:classappend="${(travel.photos.size() == 0 and iterStat.index == 0) ? 'carousel-item active' : 'carousel-item'}">

                <!-- Contenitore "immagine-like" -->
                <div class="video-container w-100 h-100 d-flex align-items-center position-relative overflow-hidden">
                  <!-- iframe per YouTube -->
                  <th:block th:if="${video.contains('youtube') or video.contains('youtu.be')}">
                    <iframe th:src="${video}" class="d-block w-100 h-100 object-fit-contain" frameborder="0" allowfullscreen></iframe>
                  </th:block>

                  <!-- video per file locali -->
                  <th:block th:unless="${video.contains('youtube') or video.contains('youtu.be')}">
                    <video controls class="d-block w-100 object-fit-contain">
                      <source th:src="${video}" />
                      Il tuo browser non supporta il tag video.
                    </video>
                  </th:block>
                </div>
              </div>
            </th:block>
          </div>

          <!-- Indicators -->
          <div class="carousel-indicators custom-thumbnails d-flex justify-content-center position-static h-auto mt-3">
            <!-- Show Images Indicators -->
            <th:block th:if="${travel.photos.size() != 0}" th:each="photo, iterStat : ${travel.photos}">
              <button type="button"
                      data-bs-target="#carousel"
                      th:attr="data-bs-slide-to=${iterStat.index}, 
                        aria-current=${iterStat.index == 0} ? 'true' : null,
                        aria-label=${'Slide ' + (iterStat.index + 1)}"
                      class="border-0 d-flex align-items-center justify-content-center p-0"
                      th:classappend="${iterStat.index == 0} ? 'active' : ''">
                <img th:src="${photo}" alt="Thumbnail" class="object-fit-contain hover-pointer w-100 h-100" draggable="false" />
              </button>
            </th:block>

            <!-- Show Videos Indicators -->
            <th:block th:if="${travel.videos.size() != 0}" th:each="video, iterStat : ${travel.videos}">
              <button type="button"
                      data-bs-target="#carousel"
                      th:attr="data-bs-slide-to=${(travel.photos.size() + iterStat.index)}, 
                        aria-current=${(travel.photos.size() == 0 and iterStat.index == 0)} ? 'true' : null,
                        aria-label=${'Slide ' + (travel.photos.size() + iterStat.index + 1)}"
                      class="border-0 d-flex align-items-center justify-content-center p-0"
                      th:classappend="${(travel.photos.size() == 0 and iterStat.index == 0) ? 'active' : ''}">
                <!-- Youtube Logo -->
                <th:block th:if="${video.contains('youtube') or video.contains('youtu.be')}">
                  <img src="/uploads/fallback/youtube-logo.png"
                    alt="Video Thumbnail"
                    class="object-fit-contain hover-pointer w-100 h-100"
                    draggable="false" />
                </th:block>
                <!-- Video tag for other videos -->
                <th:block th:unless="${video.contains('youtube') or video.contains('youtu.be')}">
                  <video height="40" preload="metadata" muted>
                    <source th:src="${video}" />
                  </video>
                </th:block>
              </button>
            </th:block>
          </div>
        </div>

        <!-- Informations -->
        <div class="travel-details pt-4 pt-lg-3 pb-3 px-4">
          <div class="d-flex justify-content-between gap-2 align-items-start mb-1">
            <!-- Place -->
            <h2 id="place" class="mb-2" th:text="*{place}"></h2>
            
            <div class="d-flex gap-1">
              <!-- Edit Travel -->
              <a class="transparent-link blue-hover h-auto p-1" th:href="@{/travel/edit/{id} (id=*{id})}">
                <i class="fa-solid fa-pencil fs-1"></i>
              </a>
              <!-- Delete Travel (Open a modal) -->
              <button type="button" class="transparent-link red-hover h-auto p-1 border-0 bg-transparent" data-bs-toggle="modal" data-bs-target="#deleteModal">
                <i class="fa-solid fa-trash fs-1"></i>
              </button>
            </div>
          </div>

          <!-- Date -->
          <h3 class="mb-4" th:text="*{date}"></h3>

          <h4>About the travel: </h4>
          <ul>
            <!-- Feelings -->
            <li class="card-text"> 
              <span class="fw-semibold">Feelings:</span>
              <p class="card-text d-inline m-0" th:utext="*{feelings != null and feelings != '' ? feelings: '<i>empty</i>'}"></p>
            </li>

            <!-- Rating -->
            <li class="card-text">
              <span class="fw-semibold">Strength Rating:</span>
              <p class="card-text d-inline m-0"
                th:with="pos=${#strings.repeat(&quot;<i class='fa-solid fa-hand-fist me-1'></i>&quot;, travel.strengthRating)}, neg=${#strings.repeat(&quot;<i class='fa-solid fa-hand-fist deselected me-1'></i>&quot;, 5 - travel.strengthRating)}" 
                th:utext="${pos + neg}"></p>
            </li>
            <li class="card-text">
              <span class="fw-semibold">Monetary Rating:</span>
              <p class="card-text d-inline m-0"
                th:with="pos=${#strings.repeat(&quot;<i class='fa-solid fa-dollar-sign me-1'></i>&quot;, travel.monetaryRating)}, neg=${#strings.repeat(&quot;<i class='fa-solid fa-dollar-sign deselected me-1'></i>&quot;, 5 - travel.monetaryRating)}" 
                th:utext="${pos + neg}"></p>
            </li>

            <!-- Cost -->
            <li class="card-text"> 
              <span class="fw-semibold">Cost:</span>
              <p class="card-text d-inline m-0">
                € [[*{cost}]]
              </p>
            </li>

            <!-- Coordinates (Invisible) -->
            <li id="latitude" class="d-none" th:text="*{latitude}"></li>
            <li id="longitude" class="d-none" th:text="*{longitude}"></li>
          </ul>

          <!-- Tags -->
          <h4 class="mb-2">Tags:</h4>
          <div class="tags-container  d-flex flex-wrap gap-3">
            <span class="badge fs-6" th:text="${tag.name}" th:each="tag : *{tags}" th:style="'background-color:' + ${tag.hexColor}"></span>
          </div>
        </div>
      </div> 

      <div class="mt-3">
        <div class="row g-2 px-2 mb-4">
          <!-- Description -->
          <div class="col-12"> 
            <h4 class="m-0">Description:</h4>
            <p class="d-inline m-0" th:text="*{description}"></p>
          </div>

          <!-- Reflections -->
          <div class="col-12 col-md-6"> 
            <h4 class="m-0">Positive Reflection:</h4>
            <p class="d-inline m-0" th:utext="*{reflectionPos != null and reflectionPos != '' ? reflectionPos: '<i>empty</i>'}"></p>
          </div>
          <div class="col-12 col-md-6"> 
            <h4 class="m-0">Negative Reflection:</h4>
            <p class="d-inline m-0" th:utext="*{reflectionNeg != null and reflectionNeg != '' ? reflectionNeg: '<i>empty</i>'}"></p>
          </div>
        </div>


        <!-- Map -->
        <div id="map" class="rounded rounded-4" style="height: 500px;"></div>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              
              <!-- Modal Header -->
              <div class="modal-header">
                <h5 class="modal-title">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <!-- Modal Body -->
              <div class="modal-body">
                Are you sure you want to delete this travel? <br> ⚠ This action cannot be undone! ⚠
              </div>

              <!-- Modal Footer -->
              <div class="modal-footer">
                <a th:href="@{/travel/delete/{id}(id=*{id})}" class="btn btn-danger">Delete</a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              </div>

            </div>
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
